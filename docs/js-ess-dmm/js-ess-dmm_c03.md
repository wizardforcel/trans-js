第 3 章

# `构建表达式`

`在本章中`

![Bullet](images/check.png) `理解表达式是什么`

![Bullet](images/check.png) `理解数字表达式`

![Bullet](images/check.png) `连接字符串表达式`

![Bullet](images/check.png) `掌握比较表达式`

![Bullet](images/check.png) `学习逻辑表达式`

在 JavaScript 编码时，你会不断使用表达式，因此了解它们是什么并熟悉可用的表达式类型至关重要。每个 JavaScript 编码者都不同，但我可以毫不犹豫地说，每个`good` JavaScript 编码者都流利地使用表达式。

这一章带你了解表达式的所有必要知识。你将发现一些表达式的基础，然后探索使用数字、字符串和布尔值构建强大表达式的多种技巧。## `理解表达式的结构`

一个 JavaScript `expression` 接受一个或多个输入，例如账单总额和小费百分比，并以某种方式将它们组合在一起——例如，通过使用乘法。在表达式术语中，输入被称为 `operands`，它们通过使用称为 `operators` 的特殊符号组合在一起。

+   `操作数:` 表达式的输入值。换句话说，它是表达式操作以产生结果的原始数据。它可以是一个数字、一个字符串、一个变量、一个函数结果（参考`[第 5 章](c05.xhtml)`），或者一个对象属性（参考`[第 6 章](c06.xhtml)`）。

+   `操作符:` 一个表示对一个或多个操作数执行特定操作的符号。例如，`*` 操作符表示乘法，而 `+` 操作符表示加法。我将在本章中讨论各种 JavaScript 操作符。

例如，以下是一个计算小费金额并将结果赋值给变量的表达式：

`tipAmount = billTotal * tipPercentage;`

表达式是等号(`=`)右边的所有内容。在这里，`billTotal` 和 `tipPercentage` 是操作数，而乘法符号(`*`)是操作符。## `创建数字表达式`

在 JavaScript 中，数学计算称为`numeric expression`，它结合数字操作数和算术操作符以产生数字结果。本节讨论所有 JavaScript 算术操作符，并向你展示如何最好地使用它们来构建有用且方便的数字表达式。

`[表 3-1](#c03-tbl-0001)` 列出了你可以在 JavaScript 表达式中使用的基本算术操作符。

JavaScript 还提供了一些额外的操作符，这些操作符结合了一些算术操作符和赋值操作符，即将值赋给变量的谦逊等号(`=`)。`[表 3-2](#c03-tbl-0002)` 列出了这些所谓的 `arithmetic assignment` 操作符。

`[表 3-1](#rc03-tbl-0001)` JavaScript 算术操作符

| `操作符` | `名称` | `示例` | `结果` |
| --- | --- | --- | --- |
| `+` | 加法 | `10 + 4` | `14` |
| `++` | 增加 | `10++` | `11` |
| `-` | 减法 | `10 - 4` | `6` |
| `-` | 取反 | `-10` | `-10` |
| `--` | 减少 | `10--` | `9` |
| `*` | 乘法 | `10 * 4` | `40` |
| `/` | 除法 | `10 / 4` | `2.5` |
| `%` | 取余 | `10 % 4` | `2` |

[表 3-2](#rc03-tbl-0002) JavaScript 算术赋值操作符

| **操作符** | **示例** | **等价** |
| --- | --- | --- |
| `+=` | `x += y` | `x = x + y` |
| `-=` | `x -= y` | `x = x - y` |
| `*=` | `x *= y` | `x = x * y` |
| `/=` | `x /= y` | `x = x / y` |
| `^=` | `x ^= y` | `x = x ^ y` |

| `%=` | `x %= y` | `x = x % y` |  ## 构建字符串表达式

字符串表达式是指至少有一个操作数是字符串，并且表达式的结果是另一个字符串。字符串表达式很简单，因为只有一个操作符需要处理：`*连接*`(`+`)。你使用这个操作符在表达式中组合（或`*连接*`）字符串。例如，表达式`"Java" + "Script"`返回字符串`"JavaScript"`。但是请注意，你也可以将字符串与下一节中讨论的比较操作符一起使用。  ## 构建比较表达式

你使用比较表达式来比较两个或多个数字、字符串、变量、属性或函数结果的值。如果表达式为真，则表达式结果被设置为布尔值`true`；如果表达式为假，则表达式结果被设置为布尔值`false`。在你的 JavaScript 代码中，你会频繁使用比较，因此理解它们是什么以及如何使用它们是很重要的。

[表 3-3](#c03-tbl-0003) 总结了 JavaScript 的比较操作符。

[表 3-3](#rc03-tbl-0003) JavaScript 比较操作符

| `**操作符**` | `**名称**` | `**示例**` | `**结果**` |
| --- | --- | --- | --- |
| `==` | 等于 | `10 == 4` | `false` |
| `!=` | 不等于 | `10 != 4` | `true` |
| `>` | 大于 | `10 > 4` | `true` |
| `<` | 小于 | `10 < 4` | `false` |
| `>=` | 大于或等于 | `10 >= 4` | `true` |
| `<=` | 小于或等于 | `10 <= 4` | `false` |
| `===` | 严格相等 | `"10" === 10` | `false` |

| `!==` | 严格不等于 | `"10" !== 10` | `true` |  ## 构建逻辑表达式

你使用逻辑表达式来组合或操作布尔值，特别是比较表达式。例如，如果你的代码需要测试两个不同的比较表达式是否都为`true`才能继续，你可以使用逻辑表达式来实现。

[表 3-4](#c03-tbl-0004) 列出了 JavaScript 的逻辑运算符。

[表 3-4](#rc03-tbl-0004) JavaScript 逻辑运算符

| `**Operator**` | `**Name**` | `**General Syntax**` | `**Returned Value**` |
| --- | --- | --- | --- |
| `&&` | 与 | `*expr1* && *expr2*` | 如果 `expr1` 和 `expr2` 都为 `true`，则返回 `true`；否则返回 `false`。 |
| ``&#124;&#124;`` | 或 | ``*expr1*`` ``&#124;&#124;`` ``*expr2*`` | 如果 ``expr1`` 或 ``expr2`` 中有一个为 ``true``，则返回 ``true``；否则返回 ``false``。 |

| ``!`` | 取反 | ``!*expr*`` | 如果 ``expr`` 为 ``false``，则返回 ``true``；如果 ``expr`` 为 ``true``，则返回 ``false``。 |  ## 理解运算符优先级

在复杂表达式中，运算顺序变得至关重要。例如，考虑表达式``3+5*2``。如果从左到右计算，得到的结果是``16``（``3+5``等于``8``, ``8*2``等于``16``）。然而，如果先进行乘法，再进行加法，结果是``13``（``5*2``等于``10``, ``3+10``等于``13``）。

为了控制这一运算顺序问题，JavaScript 会根据预定义的``运算符优先级``规则来求值表达式。这一优先级规则让 JavaScript 能够明确无误地计算一个表达式，决定首先计算表达式的哪一部分，接着哪一部分，依此类推。

### 运算符优先级

JavaScript 使用的优先级顺序由本章目前为止介绍的各种运算符决定。[表 3-5](#c03-tbl-0005) 总结了 JavaScript 使用的完整运算符优先级顺序。

例如，[表 3-5](#c03-tbl-0005) 告诉你，JavaScript 在加法之前会进行乘法运算。因此，表达式``3+5*2``（如上所述）的正确答案是``13``。

[表 3-5](#rc03-tbl-0005) JavaScript 运算符的优先级顺序

| **Operator** | **Operation** | **Order of Precedence** | **Order of Evaluation** |
| --- | --- | --- | --- |
| ``++`` | 自增 | 第一 | 右 -> 左 |
| ``--`` | 自减 | 第一 | 右 -> 左 |
| ``—`` | 取反 | 第一 | 右 -> 左 |
| ``!`` | 取反 | 第一 | 右 -> 左 |
| ``*``, ``/``, ``%`` | 乘法, 除法, 取余 | 第二 | 左 -> 右 |
| ``+``, ``—`` | 加法, 减法 | 第三 | 左 -> 右 |
| ``+`` | 字符串连接 | 第三 | 左 -> 右 |
| ``<``, ``<=`` | 小于, 小于或等于 | 第四 | 左 -> 右 |
| ``>``, ``>=`` | 大于, 大于或等于 | 第四 | 左 -> 右 |
| ``==`` | 相等 | 第五 | 左 -> 右 |
| ``!=`` | 不等于 | 第五 | 左 -> 右 |
| ``===`` | 严格相等 | 第五 | 左 -> 右 |
| ``!==`` | 严格不等于 | 第五 | 左 -> 右 |
| ``&&`` | 逻辑与运算符 | 第六优先级 | 从左到右 |
| ``&#124;&#124;`` | 逻辑或运算符 | 第六优先级 | 从左到右 |
| ``?:`` | 三元运算符 | 第七优先级 | 从右到左 |
| ``=`` | 赋值运算符 | 第八优先级 | 从右到左 |

| ``+=``, ``-=`` , 等等 | 算术赋值运算符 | 第八优先级 | 从右到左 |  ### 控制优先级顺序

有时候你可能想要控制计算顺序并覆盖优先级顺序。这可能看起来有些奇怪，因此可能需要一个例子来解释。假设你已经知道一个商品的最终价格，并且给定税率，你想要知道原始价格（即税前价格）。

对 JavaScript 计算的初步尝试可能如下所示：

``retailPrice = totalPrice / 1 + taxRate;``

然而，这样做并不起作用。为什么呢？根据优先级规则，JavaScript 会先进行除法运算，再进行加法运算，因此 `totalPrice` 的值首先会被 `1` 除以，然后再加上 `taxRate` 的值，这样就得不到正确的结果。

为了得到正确的答案，你必须覆盖优先级顺序，确保先进行加法运算 `1 + taxRate`。你可以通过在该部分表达式外加上括号来覆盖优先级，如下所示：

``const retailPrice = totalPrice / (1 + taxRate);``

一般来说，你可以使用括号来控制 JavaScript 计算表达式的顺序。括号内的项总是优先计算；括号外的项则按优先级顺序依次计算。
