第一章

# JavaScript：宏观视角

本章内容

![Bullet](images/check.png) `感受一下编程的一般过程，尤其是JavaScript`

![Bullet](images/check.png) `了解你编程所需的工具`

![Bullet](images/check.png) `为JavaScript代码添加注释`

![Bullet](images/check.png) `将代码存储在单独的JavaScript文件中`

在本章中，你将学习一些有用的JavaScript基础知识。即使你之前从未编程过，也不用担心。我会一步一步带你了解所有需要知道的内容，简单易懂。正如你将会发现的那样，编程其实非常有趣。## 将JavaScript代码添加到网页

好的，现在是时候挽起袖子，活动一下手指，开始编写代码了。本节介绍了构建和测试脚本的标准程序，并带你完成一些示例。

### `<script>`标签

脚本的基本容器自然就是HTML的`<script>`标签及其对应的`</script>`结束标签：

`<script> JavaScript语句写在这里 </script>` ### `<script>`标签放在哪儿？

除了一些特定的例外情况，`<script>`标签放置的位置并不特别重要。有些人将标签放在页面的`</head>`和`<body>`标签之间。HTML标准建议将`<script>`标签放在页面头部（即`<head>`和`</head>`之间），因此我在本书中使用的是这种风格：

```html

以下是放置脚本的任意位置的例外情况：

+   如果你的脚本需要向页面写入数据，则`<script>`标签必须放在页面的主体部分（即`<body>`和`</body>`之间），并且位置要精确到你希望文本出现的位置。

+   如果你的脚本引用了页面上的某个元素（例如一个表单对象），则脚本必须放在该元素之后。

+   对于许多HTML标签，你可以直接在标签内作为属性添加一个或多个JavaScript语句。

![Remember](images/remember.png) 完全可以在单个页面中插入多个`<script>`标签，只要每个标签都有对应的`</script>`结束标签，并且不要把一个`<script>`块放在另一个`<script>`块中。### 示例 #1：向用户显示消息

现在你已经准备好构建并尝试你的第一个脚本了。这个示例展示了所有JavaScript动作中最简单的一种：向用户显示基本消息。以下代码展示了在HTML文件中的脚本：

```html

如此处所示，将脚本放在页面的头部，保存文件后，在浏览器中打开HTML文件。

这个脚本只有一行：

`alert("Hello JavaScript World!");`

这叫做`语句`，每个语句的设计目的是执行一个特定的JavaScript任务。你的脚本可以从只有几个语句的简单程序，到由数百个语句组成的庞大项目不等。

你可能在想，语句末尾的分号（`;`）是什么意思。观察得很仔细。你用分号来标记每个JavaScript语句的结束。

在这个示例中，语句运行JavaScript的`alert()`方法，它会显示出括号内的任何消息（这可能是欢迎信息、网站的新功能公告、促销广告等）。[图1-1](#c01-fig-0001)展示了打开文件时出现的消息。

![一个警告消息的截图。消息内容为，paulmcfederies.com说你好，JavaScript世界。下方是确定按钮。](images/9781394263219-fg0101.png)

[图1-1：](#rc01-fig-0001) 当你打开包含示例脚本的HTML文件时，会出现这个“警告”信息。

浏览器是怎么知道要运行这个JavaScript语句的呢？当浏览器处理（在日常语言中叫做“解析”）一个页面时，它基本上是从HTML文件的开头开始，逐行向下执行。如果它遇到一个`<script>`标签，它就知道接下来会有一个或多个JavaScript语句，然后它会按照顺序自动执行这些语句，直到读取完毕。唯一的例外是当JavaScript语句被包含在`function`中时，我会在[第5章](c05.xhtml)中解释这一点。

![警告](images/warning.png) JavaScript编程的基本规则之一是“每行一个语句”。也就是说，每个语句必须只出现在单独的一行上，每行不能有多个语句。我在前一句的第二部分用了“应该”一词，因为你是可以将多个语句放在同一行的，只要你用分号（`;`）将它们分开。在某些情况下，确实有必要将两个或更多语句写在同一行，但你应该避免这样做，因为多语句行不容易阅读和调试。### 示例 #2：将文本写入页面

JavaScript最强大的功能之一是能够动态地将文本甚至HTML标签和CSS规则写入网页。也就是说，文本（或其他内容）会在网页加载时插入到页面中。这有什么好处呢？首先，它非常适合时间敏感的数据。例如，你可能想要显示网页最后修改的日期和时间，以便访客知道页面的更新情况（是旧的还是新的）。下面是展示这种脚本的代码：

`<html lang="en"> <head> <meta charset="utf-8"> <title>Writing Data to the Page</title> </head> <body> 这是普通的文本行。<br> <script> document.write("Last modified: " + document.lastModified) </script> <br>这是另一行普通文本。 </body> </html>`

注意脚本是如何出现在HTML文档的主体部分中的，这是每当你想将数据写入页面时必须做的。[图1-2](#c01-fig-0002)展示了结果。

![一个快照显示了一个页面，正在向页面写入数据。文本显示了文件的日期和时间。](images/9781394263219-fg0102.png)

[图 1-2:](#rc01-fig-0002) 当你打开文件时，文本会显示文件最后修改的日期和时间。

这个脚本利用了 `document` 对象，这是一个内置的 JavaScript 构造，指向脚本所在的 HTML 文件（文档）（更多关于 `document` 对象的内容，请查看[第六章](c06.xhtml)）。`document.write()` 语句告诉浏览器将括号内的内容插入到网页中。`document.lastModified` 部分返回文件最后修改并保存的日期和时间。 ## 开始所需的条件

`HTML` 和 `CSS` 最棒的地方之一就是，你开始时需要跨越的障碍不仅低，而且很少。实际上，你只需要两样东西，它们都是免费的：一个文本编辑器，用来输入文本、标签和属性；一个浏览器，用来查看结果。（当然，你还需要一个 web 服务器来托管完成的页面，但在创建页面时，服务器并不是必须的。）是的，也有一些高端的文本编辑器和精美的图形程序，但它们属于“花里胡哨”的范畴；你完全可以在没有它们的情况下创建相当不错的网页。

JavaScript 编程的基本要求与 HTML 完全相同：一个文本编辑器和一个浏览器。同样，也有一些程序可以帮助你编写和测试脚本，但你并不需要它们。  ## 处理两个特殊情况

在本书中，我做了一些与访问你发布的网页的用户相关的 JavaScript 假设：

+   这些人已经在他们的浏览器中启用了 JavaScript。

+   这些人使用的是现代网页浏览器的相对较新版本，比如 `Chrome`、`Edge`、`Safari` 或 `Firefox`。

这些假设是相当安全的，但也值得保持一些警觉，想想如何应对那一小部分不符合一个或两个测试的用户。

### 处理关闭 JavaScript 的浏览器

你不必担心网页浏览器无法处理 JavaScript，因为所有现代浏览器都已经支持 JavaScript 很长时间了。然而，你可能需要关注那些不支持 JavaScript 的人。虽然这种情况很少见，但有些人会关闭浏览器的 JavaScript 功能。为什么有人会这样做呢？很多人禁用 JavaScript 是因为他们担心安全问题，不希望在硬盘上写入 cookies 等原因。

为了处理这些反叛者，可以将 `<noscript>` 标签放置在页面的主体中：

`<noscript> <p> 嘿，你的浏览器已经关闭了 JavaScript！ </p> <p> 好吧，也许你更喜欢这个 <a href="no-js.html">非 JavaScript 版本</a> 的页面。 </p> </noscript>`

如果浏览器启用了JavaScript，则浏览器不会显示`<noscript>`标签内的任何文本。然而，如果JavaScript被禁用，浏览器会向用户显示`<noscript>`标签内的文本和标签。

若要在关闭JavaScript的情况下测试你的网站，以下是在一些流行浏览器中使用的技术：

+   `**Chrome (桌面版):**` 打开设置，点击隐私与安全，点击站点设置，点击JavaScript，然后选择不允许站点使用JavaScript选项。

+   `**Chrome (Android):**` 打开设置，点击站点设置，点击JavaScript，然后将JavaScript开关关闭。

+   `**Edge:**` 打开设置，点击设置菜单，点击Cookies和站点权限，点击JavaScript，然后将允许开关关闭。

+   `**Safari (macOS):**` 打开设置，点击高级标签，选择在菜单栏显示开发菜单，然后关闭设置。选择`开发 ⇒ 禁用JavaScript`。

+   `**Safari (iOS或iPadOS):**` 打开设置，点击Safari，点击高级，然后将JavaScript开关关闭。

+   `**Firefox (桌面版):**` 在地址栏中输入`about:config`并按回车。如果Firefox显示警告页面，点击接受风险并继续，以显示高级偏好设置页面。在搜索偏好设置名称框中输入`javascript`。在搜索结果中，查找`javascript.enabled`偏好设置。在该偏好设置的最右侧，点击切换按钮，将该偏好设置的值从`true`切换为`false`。### 处理非常旧的浏览器

本书中你将学习一种名为`ECMAScript 2015`的JavaScript版本，也被称为`ECMAScript 6`，或简称`ES6`。为什么特别选择这个版本，而不是后续版本？有两个原因：

+   `ES6`具有出色的浏览器支持，超过98%的当前浏览器支持`ES6`中发布的特性。后续版本的JavaScript支持较少。

+   `ES6`包含了你所需要的一切，可以为你的页面添加各种有用且有趣的动态功能。除非你是专业程序员，否则后续版本的JavaScript所发布的特性远超你所需。

那么，剩下的那几乎不支持`ES6`的浏览器该怎么办呢？

首先，要知道不支持ES6特性的浏览器数量正在逐渐减少。现在虽然是2%（实际上是1.7%），但六个月后会降至1%，一年后降至0.5%，依此类推，直到这个比例小到无法测量。

其次，不支持ES6的浏览器百分比因地区而异（例如，许多非洲国家的比例较高），也与环境有关。大多数不完全支持ES6的浏览器用户都在使用Internet Explorer 11，而且这些用户大多数处于无法升级的环境中（例如某些公司环境）。

如果幸运的话，你的网站可能会有较多的老旧浏览器访问，那么你可能需要放弃 ES6 的一些炫酷特性，转而使用更为稳妥的 ECMAScript 5 特性。为此，每当我介绍新的 JavaScript 特性时，我都会指出哪些是 ES6 新增的，并告诉你是否有简单的回退或解决方法（在 JavaScript 行业中称为 `polyfill`），如果你倾向于使用 ES5。## 注释你的代码

由几行组成的脚本通常很容易阅读和理解。然而，你的脚本不会一直保持如此简单，这些较长且更复杂的代码会变得更加难以阅读。（如果你在几周或几个月后回过头来看这些代码，这种困难尤其明显。）为了帮助你解读代码，良好的编程实践是广泛使用注释。`注释`是描述或解释某个语句或语句组的文字。浏览器会忽略注释，因此你可以根据需要添加尽可能多的注释。

对于简短的单行注释，使用双斜杠 (`//`)。将 `//` 放在行的开头，然后在它后面写上你的注释。以下是一个示例：

`// 显示页面上次修改的日期和时间 document.write("This page was last modified on " + document.lastModified);`

你也可以使用 `//` 注释来处理两三行文字，只要每一行都以 `//` 开头。如果你的注释超过了这一范围，那么最好使用多行注释，这些注释以 `/*` 开始，并以 `*/` 结束。以下是一个示例：

`/* 该脚本演示了 JavaScript 使用 document.write() 方法将文本写入网页，显示网页文件上次修改的日期和时间。此脚本版权归 Paul McFedries 所有。*/`

![警告](images/warning.png) 虽然在刚开始学习时添加一些评论是可以的，但你不必对每一行都加上评论。如果某个语句是微不足道的，或者它的目的显而易见，那么就省略评论，继续前进。## 转向外部 JavaScript 文件

在本章前面，我讲到了通过在网页的头部（即`<head>`和`</head>`标签之间）插入`<script>`和`</script>`标签来将 JavaScript 代码添加到网页中，或者有时将其插入到网页的主体部分（即`<body>`和`</body>`标签之间）。然后，你可以在`<script>`和`</script>`标签之间编写代码。

如果脚本较短，直接将脚本放入页面中并不会造成问题。然而，如果你的脚本（或多个脚本）有几十行或几百行，那么 HTML 代码看起来可能会显得杂乱无章。另一个可能遇到的问题是需要在多个页面上使用相同的代码。你当然可以将代码复制到每个需要的页面中，但如果以后修改了代码，那么你就需要更新所有使用该代码的页面。

解决这两个问题的方法是将代码从 HTML 文件中移到外部 JavaScript 文件中。将代码移出可以将 HTML 文件中的 JavaScript 代码减少到一行（正如你很快会学到的那样），并且意味着你只需编辑外部文件即可更新代码。

这里有一些关于使用外部 JavaScript 文件的注意事项：

+   该文件必须使用纯文本格式。

+   命名文件时，请使用 `.js` 扩展名。

+   不要在文件中使用 `<script>` 标签。只需像在 HTML 文件中一样直接输入你的语句。

+   浏览器执行外部文件中的语句的规则与 HTML 文件中的语句相同。也就是说，函数外的语句在浏览器遇到文件引用时会自动执行，而函数中的语句则需要在函数被调用时才会执行。（不确定什么是“函数”？你将在[第 5 章](c05.xhtml)中学到所有相关内容。）

为了让浏览器知道外部 JavaScript 文件的存在，可以在 `<script>` 标签中添加 `src` 属性。例如，如果外部文件名为 `myscripts.js`，则 `<script>` 标签设置如下：

`<script src="myscripts.js">`

这个例子假设 `myscripts.js` 文件与 HTML 文件位于同一目录中。如果文件位于不同目录，请相应调整 `src` 的值。例如，如果 `myscripts.js` 文件位于名为 `scripts` 的子目录中，则应使用以下方式：

`<script src="scripts/myscripts.js">`

你甚至可以通过指定完整的 URL 作为 `src` 值来引用其他网站的文件（大概是你自己的网站！）：

`<script src="http://www.host.com/myscripts.js">`

作为示例，以下代码展示了一个名为 `footer.js` 的一行外部 JavaScript 文件：

`document.write("This page is Copyright " + new Date().getFullYear());`

这行代码写入“Copyright”字样，后跟当前年份。（我知道：现在这段代码看起来像是一些真正的乱码。别担心，因为当我在[第 8 章](c08.xhtml)讨论 JavaScript Date 对象时，你将确切了解这里发生了什么。）

以下代码展示了一个包含外部 JavaScript 文件引用的 HTML 文件：

````html

当你加载页面时，浏览器会逐行解析 HTML。当它遇到 `<footer>` 标签时，它会注意到 `<script>` 标签引用的外部 JavaScript 文件。浏览器加载该文件后，会执行文件中的代码，向页面写入版权信息，如[图 1-3](#c01-fig-0003)所示。

![这张截图展示了使用外部 JavaScript 文件来显示页脚信息的页面。](images/9781394263219-fg0103.png)

[图 1-3：](#rc01-fig-0003) 该页面使用外部 JavaScript 文件来显示页脚信息。
