## 插入排序的效率

插入排序中发生了四种类型的步骤：移除、比较、移位和插入。为了分析插入排序的效率，我们需要统计每一种步骤。

首先，让我们深入了解比较。每次我们将间隙左侧的值与`tempValue`进行比较时，都会发生比较。在最坏的情况下，数组按逆序排序，我们必须在每次遍历中将`tempValue`左侧的每个数字与`tempValue`进行比较。这是因为`tempValue`左侧的每个值总是大于`tempValue`，因此遍历将仅在间隙达到数组左端时结束。

在第一次遍历中，`tempValue` 是索引 `1` 的值，最多进行一次比较，因为`tempValue`左侧只有一个值。在第二次遍历中，进行的最大比较次数是二，依此类推。在最后一次遍历中，我们需要将 `tempValue` 与数组中除 `tempValue` 自身之外的每个值进行比较。换句话说，如果数组中有 `N` 个元素，那么在最后一次遍历中进行的最大比较次数是 `N - 1`。

因此，我们可以将总的比较次数公式化为：

`1 + 2 + 3 + … + (N - 1)` 次比较。

在我们包含 `five` 个元素的示例数组中，最多会有：

`1 + 2 + 3 + 4 = 10` 次比较。

对于一个包含 `10` 个元素的数组，会有：

`1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 = 45` 次比较。

对于一个包含 `20` 个元素的数组，总共会有 `190` 次比较，等等。

当检查这一模式时，出现了一个规律：对于一个包含 `N` 个元素的数组，大约有 `N² / 2` 次比较。（`10² / 2` 是 `50`，`20² / 2` 是 `200`。我们将在下一章更仔细地观察这一模式。）

让我们继续分析其他类型的步骤。

每次我们将一个值向右移动一个单元格时，就会发生移位。当数组按逆序排序时，移位的次数与比较的次数相同，因为每个比较都迫使我们将一个值向右移。

让我们将最坏情况下的比较和移位相加：

`N² / 2` 次比较

`+ N² / 2` 次移位

_____________________________

`N²` 步骤

从数组中移除并插入 `tempValue` 每次遍历时发生一次。由于总是有 `N - 1` 次遍历，我们可以得出 `N - 1` 次移除和 `N - 1` 次插入。

所以现在我们得到了：

`N²` 次比较和移位结合

`N - 1` 次移除

`+ N - 1` 次插入

_____________________________

`N² + 2N - 2` 步骤

你已经学到大 O 的一个主要规则：大 O 忽略常数。考虑到这一规则，我们——乍一看——可以将其简化为 `O(N² + N)`。

然而，我现在要揭示大 O 的另一个主要规则：

大 O 符号只考虑多个阶次相加时的最高阶次的 `N`。

换句话说，如果我们有一个算法，其时间复杂度为`N⁴ + N³ + N² + N`步，我们只考虑`N⁴`为重要项——并称之为`O(N⁴)`。这是为什么呢？

看看下面的表格：

| N | N² | N³ | N⁴ |
| --- | --- | --- | --- |
| 2 | 4 | 8 | 16 |
| 5 | 25 | 125 | 625 |
| 10 | 100 | 1,000 | 10,000 |
| 100 | 10,000 | 1,000,000 | 100,000,000 |

随着`N`的增加，`N⁴`变得远比任何其他阶数的重要，以至于较小的阶数被视为微不足道。例如，当我们查看表格的底行时，当我们添加`N⁴ + N³ + N² + N`时，总数为`101,010,100`。但我们可以将其四舍五入到`100,000,000`，这可以通过忽略`N`的较低阶数来实现。

我们可以将这个概念应用于`Insertion Sort`。尽管我们已经将`Insertion Sort`简化到`N² + N`步，但我们通过丢弃低阶项进一步简化了这个表达式，将其简化为`O(N²)`。

在最坏情况下，`Insertion Sort`的时间复杂度与`Bubble Sort`和`Selection Sort`相同。它们都是`O(N²)`。

我在上一章中提到，尽管`Bubble Sort`和`Selection Sort`都是`O(N²)`，但`Selection Sort`更快，因为`Selection Sort`有`N² / 2`步，而`Bubble Sort`则有`N²`步。乍一看，我们可能会说`Insertion Sort`和`Bubble Sort`一样慢，因为它也大约需要`N²`步。

如果我在这里停止书籍，你可能会认为`Selection Sort`是三者中最佳的选择，因为它比`Bubble Sort`或`Insertion Sort`快两倍。但事实并没有那么简单。
