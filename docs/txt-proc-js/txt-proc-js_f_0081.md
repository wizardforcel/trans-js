| 食谱 69 | 匹配带有千位分隔符的格式化数字 |
| --- | --- |

### 任务

假设你正在开发一个价格比较应用程序，帮助用户比较各大在线零售商的产品或服务价格。由于价格通常包含千位分隔符，你可能需要一个能够准确检测带千位分隔符的数字的正则表达式模式。

所以，如果一个网站以这样的方式列出产品：

|   | 超值优惠！$7,499 %20 降价 |
| --- | --- |

正则表达式应该能够提取出7,499。

### 解决方案

要提取带有千位分隔符的数字，可以使用此函数：

[part_3/matching_thousand_separators/matching_thousand_separators_ex1.js](http://media.pragprog.com/titles/fkjavascript/code/part_3/matching_thousand_separators/matching_thousand_separators_ex1.js)

|   | **function** extractNumbers(str) { |
| --- | --- |
|   | **const** re = */**\d{1,3}(?:**,**\d{3})*****(?:\.\d**+**)?**/g*; |
|   | **return** str.match(re)[0]; |
|   | } |
|   |  |
|   | extractNumbers(*"超值优惠！$7,499 %20 降价"*); |
|   | *// → "7,499"* |

该代码中的正则表达式模式匹配使用逗号作为千位分隔符、点号作为小数点分隔符的数字。匹配小数部分是可选的，但如果没有小数部分，则不应包含小数点。

### 讨论

数字中有大量位数时，通常会使用分隔符（如逗号或点）将其分组，以便更容易阅读。通常，英语国家使用逗号作为分隔符，如20,000，而欧洲国家则使用点号或空格，如20.000或20 000。

这个模式首先匹配1到3个数字，然后是一个匹配零个或多个由逗号和三位数字组成的组合。两个模式的组合可以匹配任何由逗号分隔的三位数字组成的数字。如果小数部分是可选的，我们只需在该组后面加上一个问号。

让我们逐步分析这个正则表达式模式：

|   | /\d{1,3}(?:,\d{3})*(?:\.\d+)?/ |
| --- | --- |
|   |  |
|   | ● \d 匹配一个数字 |
|   | ○ {1,3} 匹配前一个符号 1 到 3 次 |
|   | ● (?:,\d{3}) 非捕获分组 |
|   | ○ , 匹配逗号字符 |
|   | ○ \d 匹配一个数字 |
|   | ○ {3} 匹配前一个符号恰好 3 次 |
|   | ● * 匹配前一个符号零次或多次 |
|   | ● (?:\.\d+)? 非捕获分组 |
|   | ○ \. 匹配句点字符 |
|   | ○ \d 匹配一个数字 |
|   | ○ + 匹配前一个符号 1 次或多次 |
|   | ● ? 匹配前一个符号零次或一次 |

以下是一些符合此模式的数字示例：

|   | 1 |
| --- | --- |
|   | 100 |
|   | 1,000 |
|   | 10,000 |
|   | 100,000 |
|   | 1,000,000 |
|   | 1,000,000.00（千位分隔符后跟小数点） |

以下是一些不会正确匹配的数字示例：

|   | 1.000.000（句点代替逗号） |
| --- | --- |
|   | 1,00（数字分组不正确） |
|   | 10,0（数字分组不正确） |

为了匹配使用句点而非逗号作为千位分隔符的数字，我们需要稍微调整模式。将第二个分组中的逗号替换为句点，将第三个分组中的句点替换为逗号：

[part_3/matching_thousand_separators/matching_thousand_separators_ex2.js](http://media.pragprog.com/titles/fkjavascript/code/part_3/matching_thousand_separators/matching_thousand_separators_ex2.js)

|   | **function** extractNumbers(str) { |
| --- | --- |
|   | **const** re = */**\d{1,3}(?:\.\d{3})*****(?:**,**\d**+**)?**/g*; |
|   | **return** str.match(re)[0]; |
|   | } |
|   |  |
|   | extractNumbers(*"For sale €1.499.000 3 beds 4 baths"*)； |
|   | *// → "1.499.000"* |

这个函数允许我们匹配像德国、希腊和意大利等国家使用的千位分隔符。如果你想为数字添加千位分隔符，可以利用在第15个食谱中讨论的`intl.numberformat()`构造函数，参见 [*使用Intl.NumberFormat()为数字添加千位分隔符*](f_0025.xhtml#rcp.adding_thousand_separators)。
