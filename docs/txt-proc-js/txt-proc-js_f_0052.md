| 配方 41 | 使用 m 标志强制 ^ 和 $ 匹配行的开始和结束 |
| --- | --- |

### 任务

假设你有一个电影字幕数据库，并希望提供一个搜索机制，返回包含特定词汇的完整行。你已经在配方 24 中了解了如何确认字符串的开始和结束，[*使用 ^ 和 $ 确认字符串的开始或结束*](f_0035.xhtml#rcp.dollar)。

但是这一次，你需要确认行的开始和结束。所以，如果搜索词是“McClaren”，而字幕文件中包含这些行：

|   | ... |
| --- | --- |
|   |  |
|   | 491 |
|   | 00:39:21,396 --> 00:39:23,481 |
|   | 尽快准备好那架飞机。 |
|   |  |
|   | 492 |
|   | 00:39:23,565 --> 00:39:27,485 |
|   | 麦克拉伦博士可能会失去他的腿 |
|   | 如果没有得到适当的医疗照顾。 |
|   |  |
|   | ... |

你只想提取包含“McClaren”的行：

|   | 麦克拉伦博士可能会失去他的腿 |
| --- | --- |

### 解决方案

要提取完整的行，请在正则表达式模式的开头放置一个插入符号（^），并在结尾放置一个美元符号（$）。然后，通过设置 m 标志启用多行模式：

[part_2/flag_multiline/multiline_ex1.js](http://media.pragprog.com/titles/fkjavascript/code/part_2/flag_multiline/multiline_ex1.js)

|   | **const** re = */^.***\b**McClaren**\b**.*$/m*; |
| --- | --- |
|   | **const** str = *`* |
|   | *491* |
|   | *00:39:21,396 --> 00:39:23,481* |
|   | *尽快准备好那架飞机。* |
|   |  |
|   | *492* |
|   | *00:39:23,565 --> 00:39:27,485* |
|   | *麦克拉伦博士可能会失去他的腿* |
|   | *如果没有得到适当的医疗照顾。* |
|   | *`*; |
|   |  |
|   | str.match(re)[0]; |
|   | *// → "麦克拉伦博士可能会失去他的腿"* |

使用 m 标志后，你的正则表达式能够匹配包含“McClaren”这个词的整行文本。

| 从服务器读取文件 |
| --- |
| ![images/aside-icons/info.png](images/aside-icons/info.png) | 理想情况下，你会想从服务器读取一个字幕，一个有用的工具就是 `fetch()` 方法。^([[25]](f_0064.xhtml#FOOTNOTE-25)) |

### 讨论

多行标志允许正则表达式引擎处理由多行组成的字符串。默认情况下，插入符号（^）和美元符号（$）表示字符串的开始和结束，但在多行模式下，它们匹配每一行的开始和结束（由不可打印字符如 \n 和 \r 限定）。对比：

[part_2/flag_multiline/multiline_ex2.js](http://media.pragprog.com/titles/fkjavascript/code/part_2/flag_multiline/multiline_ex2.js)

|   | **const** str = *`* |
| --- | --- |
|   | *Anderson* |
|   | *Miller* |
|   | *McClaren* |
|   | *`*; |
|   |  |
|   | **const** re1 = */^McClaren$/*; |
|   | **const** re2 = */^McClaren$/m*; |
|   |  |
|   | re1.test(str); *// → false* |
|   | re2.test(str); *// → true* |

在这个字符串中，每个单词的末尾都有一个不可打印的换行符，这标志着一行文本的结束和新一行的开始。你可以通过在字符串中搜索转义序列（\n）来确认这一点：

[part_2/flag_multiline/multiline_ex3.js](http://media.pragprog.com/titles/fkjavascript/code/part_2/flag_multiline/multiline_ex3.js)

|   | **const** str = *`* |
| --- | --- |
|   | *Anderson* |
|   | *Miller* |
|   | *McClaren* |
|   | *`*; |
|   |  |
|   | **const** re = */Anderson**\n**/*; |
|   |  |
|   | re.test(str); *// → true* |
| 什么是不可打印字符？ |
| --- |
| ![images/aside-icons/info.png](images/aside-icons/info.png) | 不可打印字符（也称为控制字符）并不代表书面符号。相反，它告诉某些应用程序（如网页浏览器）文档应该如何显示。不可打印字符用于指示格式化操作，如水平制表符、换行符、回车符等。 |

让我们深入探讨一下正则表达式模式：

|   | /^.*\bMcClaren\b.*$/m; |
| --- | --- |
|   |  |
|   | ● ^ 表示行首的位置 |
|   | ● . 匹配任意字符 |
|   | ○ * 匹配前一个标记出现零次或无限次 |
|   | ● \b 表示单词边界的位置 |
|   | ● McClaren 匹配字符 "McClaren" |
|   | ● \b 表示单词边界的位置 |
|   | ● . 匹配任意字符 |
|   | ○ * 匹配前一个标记出现零次或无限次 |
|   | ● $ 表示行尾的位置 |
|   | ● 标志 |
|   | ○ m 启用多行模式 |

最重要的是，在你想改变默认行为时，要使用多行标志（m），这样可以改变插入符号（^）和美元符号（$）匹配行首和行尾的方式。
