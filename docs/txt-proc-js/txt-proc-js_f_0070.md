| 配方58 | 验证加拿大邮政编码 |
| --- | --- |

### 任务

假设你有一家专门面向加拿大客户的商店，你希望确保用户输入的邮政编码是有效的加拿大邮政编码。

在加拿大，邮政编码由六个字符组成，包含字母和数字。编码的格式为A1A 1A1，其中字母A代表字母表中的任意字母，数字1代表任意数字。第三个和第四个字符之间由一个空格隔开。

例如，多伦多CN塔的邮政编码是M5V 1J2。你希望创建一个正则表达式来匹配这种格式的邮政编码，但不包括无效的模式，如A1A 1A1A、111 111、A1A1A1、A1A-A1A或12A 1B1。

### 解决方案

使用以下函数：

[part_3/validating_ca_postal/ca_postal_ex1.js](http://media.pragprog.com/titles/fkjavascript/code/part_3/validating_ca_postal/ca_postal_ex1.js)

|   | **function** isValidPostalCode(postalCode) { |
| --- | --- |
|   | **const** re = */^**(?!**.***[**DFIOQU**])[**A-VXY**][**0-9**][**A-Z**]\s[**0-9**][**A-Z**][**0-9**]**$/*; |
|   | **return** re.test(postalCode); |
|   | } |
|   |  |
|   | isValidPostalCode(*"A1A 1A1A"*); *// → false* |
|   | isValidPostalCode(*"111 111"*); *// → false* |
|   | isValidPostalCode(*"A1A1A1"*); *// → false* |
|   | isValidPostalCode(*"A1A-A1A"*); *// → false* |
|   | isValidPostalCode(*"12A 1B1"*); *// → false* |
|   | isValidPostalCode(*"M5V 1J2"*); *// → true* |

这段代码帮助你确认提供的输入是否符合加拿大邮政编码格式。

### 讨论

本配方中的正则表达式首先使用了一个负向前瞻，禁止在字符串中的任何位置出现D、F、I、O、Q或U。因为这些字母与其他字符相似，所以在加拿大邮政编码中排除了D、F、I、O、Q和U。这是因为D、I和O可能与0、1和0混淆，而F、Q和U可能与E、0和V混淆。

正则表达式中的模式 .* 位于负向前瞻的开头，告诉正则引擎，所寻求的字符类型可以出现在字符串的任何位置，而不仅仅是在开头。

加拿大邮政编码不能以字母 W 或 Z 开头。为了确保字符串的第一个字符不是 W 或 Z，我们使用字符类 [A-VXY]。这告诉正则引擎，字符必须是 A 到 V、X 或 Y 中的任何字母，但不能是 W 或 Z。

除了前面提到的两种情况，加拿大的邮政编码遵循一个简单的模式，由六个交替的字母数字字符组成，中间可以有一个空格。

让我们更深入地分析这个模式：

|   | /^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s[0-9][A-Z][0-9]$/ |
| --- | --- |
|   |  |
|   | ● ^ 确定字符串开始位置 |
|   | ● (?!.*[DFIOQU]) 负向前瞻：确认以下正则表达式不匹配 |
|   | ○ . 匹配任何字符（除了行终止符） |
|   | ○ * 匹配前一个符号零次或无限次 |
|   | 尽可能多次 |
|   | ○ [DFIOQU] 匹配列表 DFIOQU 中的单个字符 |
|   | ● [A-VXY] 匹配列表中存在的单个字符 |
|   | ○ A-V 匹配 A 到 V 范围内的单个字符 |
|   | ○ XY 匹配列表 XY 中的单个字符 |
|   | ● [0-9] 匹配 0 到 9 范围内的单个字符 |
|   | ● [A-Z] 匹配 A 到 Z 范围内的单个字符 |
|   | ● \s 匹配任何空白字符 |
|   | ● [0-9] 匹配 0 到 9 范围内的单个字符 |
|   | ● [A-Z] 匹配 A 到 Z 范围内的单个字符 |
|   | ● [0-9] 匹配 0 到 9 范围内的单个字符 |
|   | ● $ 确定字符串的结尾位置 |

要在字符串中定位加拿大邮政编码，将 ^ 和 $ 替换为单词边界（\b）：/\b(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s[0-9][A-Z][0-9]\b/。

通过验证邮政编码，您可以避免地址数据中的错误，从而提高货物或服务交付到预期收件人的效率和可靠性。
