| 食谱 37 | 使用反斜杠转义元字符 |
| --- | --- |

### 任务

假设你有一个包含引用的数组，其中使用方括号将单词包含在引用中，这些单词并不是原始引用的一部分：

|   | const quotes = [ |
| --- | --- |
|   | "孩子们[汉塞尔与格蕾特]找到了一座糖果做的房子。", |
|   | "幸运之神眷顾勇者。", |
|   | "他们[法国]明天将与英格兰队比赛。", |
|   | "你曾经渴望的一切都在恐惧的另一边。", |
|   | // ... |
|   | ] |

你希望找到那些包含方括号的实例，以便将它们添加到新的集合中以进行搜索：

|   | const quotesWithMod = [ |
| --- | --- |
|   | "孩子们[汉塞尔与格蕾特]找到了一座糖果做的房子。", |
|   | "他们[法国]明天将与英格兰队比赛。", |
|   | ] |

因为括号在正则表达式中有特殊含义，所以你需要一种方法来转义括号字符，以匹配实际的括号。

### 解决方案

通过在括号前加反斜杠（\）来匹配实际的括号：

[part_2/backslash/backslash_ex1.js](http://media.pragprog.com/titles/fkjavascript/code/part_2/backslash/backslash_ex1.js)

| 1:  | **const** quotes = [ |
| --- | --- |
| -  | *"孩子们[汉塞尔与格蕾特]找到了一座糖果做的房子。"*, |
| -  | *"幸运之神眷顾勇者。"*, |
| -  | *"他们[法国]明天将与英格兰队比赛。"*, |
| 5:  | *"你曾经渴望的一切都在恐惧的另一边。"*, |
| -  | *// ...* |
| -  | ] |
| -  |  |
| -  | **const** quotesWithMod = []; |
| 10:  | **const** re = */**\[\w**+**(?:\s\w**+**)*****\]**/*; |
| -  |  |
| -  | quotes.forEach(quote => { |
| -  | **if** (re.test(quote)) { |
| -  | quotesWithMod.push(quote); |
| 15:  | } |
| -  | }); |
| -  |  |
| -  | console.log(quotesWithMod); |
| -  |  |
| 20:  | *// 日志:* |
| -  | *// [* |
| -  | *// "孩子们[汉塞尔与格蕾特]找到了一座糖果做的房子。"* |
| -  | *// "他们[法国]明天将与英格兰队比赛。"* |
| -  | *// ]* |

现在你有了一个独立的数组，其中包含了原始引号中不属于原引号的单词。

### 讨论

我们示例中的正则表达式匹配任何被方括号包围的文本，方括号内可以包含一个或多个由空格分隔的单词。注意方括号前的反斜杠字符 [ 和 ]。如果没有反斜杠，这些括号将被当作字符类处理。\w 和 \s 是不同的：它们前面的反斜杠是表达式的一部分，创建了一个简写字符类（参见第28条，[*使用字符类匹配字符范围*](f_0039.xhtml#rcp.character_class_range)）。

当反斜杠后面跟着某些字符时，它在正则表达式中有特殊意义。例如，\n 代表换行符，\s 匹配一个空白字符。但我们也可以使用反斜杠来转义元字符。当我们想去除元字符的特殊意义，将其作为字面字符使用时，需要在其前面加上反斜杠。例如，要匹配反斜杠后跟字母“s”，我们写成 \\s。

让我们一步一步地来看这个正则表达式模式：

|   | /\[\w+(?:\s\w+)*\]/ |
| --- | --- |
|   |  |
|   | ● \[ 字面匹配字符 "[" |
|   | ● \w 匹配一个单词字符（ASCII字母、数字或下划线） |
|   | ○ + 匹配前一个符号出现一次或多次 |
|   | ● (?:\s\w+)* 非捕获组 |
|   | ○ (?: 表示非捕获组的开始 |
|   | ○ \s 匹配一个空白字符 |
|   | ○ \w 匹配一个单词字符（ASCII字母、数字或下划线） |
|   | ○ + 匹配前一个符号出现一次或多次 |
|   | ○ ) 关闭非捕获组 |
|   | ○ * 匹配前一个符号出现零次或多次 |
|   | ● \] 字面匹配字符 "]" |

在第12行，我们尝试使用forEach()方法遍历quotes数组中的每个引用。在循环内部，我们调用regex的test()方法来检查当前的引用是否包含被方括号括起来的单词。如果test返回true，我们使用push()方法将当前的引用添加到quotesWithMod数组中。

最终，quotesWithMod数组将包含所有来自quotes数组的引用，这些引用中包含一个被方括号括起来的单词。

| 转义普通字符 |
| --- |
| ![images/aside-icons/tip.png](images/aside-icons/tip.png) | 如果你尝试转义一个不是元字符的字符，那么该字符将被当作字面字符处理，不会发生任何变化。换句话说，转义一个非元字符对引擎的解析没有任何影响。以下是一个例子：`code`标签不应该出现在这里。但这个规则有一个例外：如果你设置了u标志，引擎将对反斜杠的使用进行更严格的检查，并会抛出错误。关于u标志的更多信息，请参阅第43条[*启用Unicode特性（u标志）*](f_0054.xhtml#rcp.flag_u)。 |

请记住，当你希望取消元字符的特殊含义并将其作为字面字符使用时，可以使用反斜杠来转义它。
